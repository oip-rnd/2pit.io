<!-- 
/**
 * PpitCore V1.0 (https://github.com/p-pit/PpitCore)
 *
 * @link      https://github.com/p-pit/PpitCore
 * @copyright Copyright (c) 2016 Bruno Lartillot
 * @license   https://github.com/p-pit/PpitCore/blob/master/license.txt GNU-GPL license
 */
-->
			
<!-- Global message -->
<?php if ($message == 'OK') : ?>
	<div id="message">
			<div class="alert alert-success"><h4><?php echo $this->translate('Your request has been registered', 'ppit-core', $context->getLocale()) ?></h4></div>
	</div>
<?php endif;?>

<!-- Duplicate error -->
<?php if ($error == 'Duplicate') : ?>
	<div class="alert alert-danger" style="text-align: center">
		<strong><?php echo $this->translate('This record already exist', 'ppit-core', $context->getLocale()) ?></strong>
	</div>
<?php endif;?>

<!-- Isolation error -->
<?php if ($error == 'Isolation') : ?>
	<div class="alert alert-danger" style="text-align: center">
		<strong><?php echo $this->translate('The database has evolved in the meantime, please input again', 'ppit-core', $context->getLocale()) ?></strong>
	</div>
<?php endif;?>

<!-- Consistency error -->
<?php if ($error == 'Consistency') : ?>
	<div class="alert alert-danger" style="text-align: center">
		<strong><?php echo $this->translate('The data are not consistent', 'ppit-core', $context->getLocale()) ?></strong>
	</div>
<?php endif;?>

<!--  CSRF -->
<?php $element = $csrfForm->get('csrf') ?>
    <div class="form-group">
		<?php echo $this->formElement($element) ?>
<?php if ($this->formElementErrors($element)) : ?>
		<div class="alert alert-danger" style="text-align: center">
			<strong><?php echo $this->translate('The form has expired, please input again', 'ppit-core', $context->getLocale()) ?></strong>
		</div>
<?php endif;?>
	</div>

	<input type="hidden" id="event_update_time" value="<?php echo $event->update_time ?>" />

<?php $first = true; foreach ($description['update'] as $propertyId => $property) : ?>

	<?php if ($property['type'] == 'separator') : ?>
	<hr>
	<div class="form-group row">
		<label class="col-sm-12 control-label">
			<?php echo $context->localize($options['label']) ?>
		</label>
	</div>
		
	<?php else : ?>
	
		<?php if ($property) : ?>
	
	<div class="form-group row" id="<?php echo (($property['type'] == 'date' || $property['type'] == 'number') ? 'input_' : '').$propertyId ?>_group">
		<label class="col-sm-5 control-label" for="<?php echo $propertyId ?>">
			<?php if (array_key_exists('mandatory', $property) && $property['mandatory']) echo '* ' ?><?php echo $context->localize($property['labels']) ?>
		</label>
		<div class="col-sm-7">

			<?php if ($propertyId == 'place_id') : ?>
			<select class="form-control updatable-control <?php if ($first) echo 'focused-control' ?>" id="<?php echo $propertyId ?>" name="<?php echo $propertyId ?>" <?php if (array_key_exists('mandatory', $property) && $property['mandatory']) echo 'required' ?>>
    			<option />
				<?php foreach ($places as $place) : ?>
    			<option value="<?php echo $place->id ?>" <?php if ($event->place_id == $place->id) echo 'selected="selected"' ?>><?php echo $place->caption ?></option>
				<?php endforeach;?>
			</select>

			<?php elseif ($property['type'] == 'date') : ?>
			<input type="hidden" id="<?php echo $propertyId ?>" name="<?php echo $propertyId ?>" />
			<input class="form-control update_date updatable-control <?php if ($first) echo 'focused-control' ?>" id="input_<?php echo $propertyId ?>" name="input_<?php echo $propertyId ?>" value="<?php echo $context->decodeDate($event->properties[$propertyId]) ?>" <?php if (array_key_exists('mandatory', $property) && $property['mandatory']) echo 'required' ?> />

			<?php elseif ($property['type'] == 'number') : ?>
			<input type="hidden" id="<?php echo $propertyId ?>" name="<?php echo $propertyId ?>" />
			<input class="form-control updatable-control <?php if ($first) echo 'focused-control' ?>" id="input_<?php echo $propertyId ?>" name="input_<?php echo $propertyId ?>" value="<?php echo $context->formatFloat($event->properties[$propertyId], 2) ?>" <?php if (array_key_exists('mandatory', $property) && $property['mandatory']) echo 'required' ?> />

			<?php elseif ($property['type'] == 'textarea') : ?>
			<textarea class="form-control updatable-control <?php if ($first) echo 'focused-control' ?>" id="<?php echo $propertyId ?>" name="<?php echo $propertyId ?>" <?php if (array_key_exists('mandatory', $property) && $property['mandatory']) echo 'required' ?>><?php echo $event->properties[$propertyId] ?></textarea>

			<?php elseif ($property['type'] == 'select') : ?>
			<select class="form-control updatable-control <?php if ($first) echo 'focused-control' ?>" id="<?php echo $propertyId ?>" name="<?php echo $propertyId ?>" <?php if (array_key_exists('mandatory', $property) && $property['mandatory']) echo 'required' ?>>
    			<option />
				<?php foreach ($property['modalities'] as $key => $labels) : ?>
    			<option value="<?php echo $key ?>" <?php if ($event->properties[$propertyId] == $key) echo 'selected="selected"' ?>><?php echo $context->localize($labels) ?></option>
				<?php endforeach;?>
			</select>

            <?php elseif ($property['type'] == 'multiselect') : ?>
	         <?php $values = explode(',', $event->properties[$propertyId]) ?>
	        <select class="form-control update_selectpicker updatable-control <?php if ($first) echo 'focused-control' ?>" id="<?php echo $propertyId ?>" name="<?php echo $propertyId ?>" multiple <?php if (array_key_exists('mandatory', $property) && $property['mandatory']) echo 'required' ?>>
	           <option />
	           <?php foreach ($property['modalities'] as $key => $labels) : ?>
	           <option value="<?php echo $key ?>" <?php if (in_array($key, $values)) echo 'selected="selected"' ?>><?php echo $context->localize($labels) ?></option>
	           <?php endforeach;?>
	        </select>

			<?php else : ?>
			<input class="form-control updatable-control <?php if ($first) echo 'focused-control' ?>" id="<?php echo $propertyId ?>" value="<?php echo $event->properties[$propertyId] ?>" <?php if (array_key_exists('mandatory', $property) && $property['mandatory']) echo 'required' ?> />

			<?php endif;?>
		</div>

		<div class="col-sm-12"><p class="help-block" id="<?php echo (($property['type'] == 'date' || $property['type'] == 'number') ? 'input_' : '').$propertyId ?>_error"></p></div>
	</div>

		<?php $first = false; endif;?>
	<?php endif;?>
<?php endforeach;?>
